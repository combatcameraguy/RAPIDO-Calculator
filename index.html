<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RAPIDO Handyman Quote Request - General Maintenance Services Added</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@700;800&display=swap" rel="stylesheet">
    
    <!-- PWA Metadata -->
    <meta name="description" content="Request a quote for professional handyman services in Lawton, Oklahoma">
    <meta name="theme-color" content="#d97706">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="RAPIDO Quote">
    
    <!-- html2pdf.js library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    
    <!-- Firebase SDK v9 (compat mode for easier usage) -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <!-- Firebase Configuration -->
    <script>
        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDvYPFm6PtVXKc01Uo1_CMGqrWFp_oXbm0",
            authDomain: "rapido-dashboard.firebaseapp.com",
            databaseURL: "https://rapido-dashboard-default-rtdb.firebaseio.com",
            projectId: "rapido-dashboard",
            storageBucket: "rapido-dashboard.firebasestorage.app",
            messagingSenderId: "917389932203",
            appId: "1:917389932203:web:dac142f05ed07d21ee69ee"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
    </script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #b45309 0%, #d97706 100%);
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 950px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #b45309 0%, #d97706 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 48px;
            margin-bottom: 5px;
            font-weight: 800;
            letter-spacing: 3px;
            font-family: 'Kanit', sans-serif;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        
        .header h1 .icon {
            font-size: 42px;
            animation: pulse 2s ease-in-out infinite;
        }
        
        .header h1 .lightning {
            filter: drop-shadow(0 0 10px rgba(255, 255, 255, 0.8));
        }
        
        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.1);
            }
        }
        
        .header .subtitle {
            font-size: 16px;
            opacity: 0.95;
            margin-bottom: 10px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 14px;
        }
        
        .version {
            font-size: 10px;
            opacity: 0.7;
            margin-top: 10px;
            font-weight: 400;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .connection-status {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 8px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            font-size: 9px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .connection-status.online {
            background: rgba(34, 197, 94, 0.2);
            color: #bbf7d0;
        }
        
        .connection-status.offline {
            background: rgba(239, 68, 68, 0.2);
            color: #fca5a5;
        }
        
        .connection-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            animation: pulse-dot 2s ease-in-out infinite;
        }
        
        .connection-status.online .connection-dot {
            background: #22c55e;
            box-shadow: 0 0 6px rgba(34, 197, 94, 0.8);
        }
        
        .connection-status.offline .connection-dot {
            background: #ef4444;
            box-shadow: 0 0 6px rgba(239, 68, 68, 0.8);
        }
        
        @keyframes pulse-dot {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }
        
        
        .content {
            padding: 30px;
        }
        
        .info-banner {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border: 2px solid #d97706;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 25px;
        }
        
        .info-banner h3 {
            color: #92400e;
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        .info-banner p {
            color: #92400e;
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 8px;
        }
        
        .info-banner p:last-child {
            margin-bottom: 0;
        }
        
        .disclaimer {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 25px;
        }
        
        .disclaimer p {
            color: #856404;
            font-size: 13px;
            line-height: 1.6;
            margin: 0;
        }
        
        .error-message, .success-message {
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
            font-size: 16px;
            animation: slideDown 0.3s ease-out;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .error-message {
            background: #f8d7da;
            border: 3px solid #dc3545;
            color: #721c24;
        }
        
        .error-message code {
            background: rgba(0, 0, 0, 0.1);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            display: inline-block;
            margin: 4px 0;
        }
        
        .error-message a {
            color: #d97706;
            text-decoration: underline;
            font-weight: 600;
        }
        
        .error-message a:hover {
            color: #b45309;
        }
        
        .success-message {
            background: #d4edda;
            border: 3px solid #28a745;
            color: #155724;
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
        }
        
        .success-message strong {
            font-size: 18px;
            display: block;
            margin-bottom: 8px;
        }
        
        .error-message.show, .success-message.show {
            display: block;
        }
        
        .section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .section-title {
            font-size: 18px;
            font-weight: 600;
            color: #d97706;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #d97706;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
            font-size: 15px;
        }
        
        label .required {
            color: #e74c3c;
        }
        
        label .price-note {
            font-weight: normal;
            color: #666;
            font-size: 13px;
        }
        
        select, input[type="number"], input[type="text"], input[type="email"], textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 15px;
            transition: border-color 0.3s;
            font-family: inherit;
        }
        
        textarea {
            min-height: 80px;
            resize: vertical;
        }
        
        select:focus, input:focus, textarea:focus {
            outline: none;
            border-color: #d97706;
        }
        
        select:disabled, input:disabled {
            background-color: #e9ecef;
            cursor: not-allowed;
        }
        
        /* Smart Address Autocomplete Styles */
        .address-autocomplete-wrapper {
            position: relative;
        }
        
        .address-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 2px solid #d97706;
            border-top: none;
            border-radius: 0 0 6px 6px;
            max-height: 250px;
            overflow-y: auto;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            display: none;
        }
        
        .address-suggestions.show {
            display: block;
        }
        
        .address-suggestion-item {
            padding: 12px 15px;
            cursor: pointer;
            transition: background-color 0.2s;
            border-bottom: 1px solid #f0f0f0;
            font-size: 14px;
        }
        
        .address-suggestion-item:last-child {
            border-bottom: none;
        }
        
        .address-suggestion-item:hover {
            background-color: #fef3c7;
        }
        
        .address-suggestion-item.selected {
            background-color: #fde68a;
        }
        
        .suggestion-type {
            font-size: 11px;
            color: #666;
            font-weight: 600;
            text-transform: uppercase;
            margin-bottom: 2px;
        }
        
        
        .checkbox-group {
            display: flex;
            align-items: center;
            padding: 15px;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .checkbox-group:hover {
            border-color: #d97706;
            background: #fef3c7;
        }
        
        .checkbox-group input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-right: 12px;
            cursor: pointer;
        }
        
        .checkbox-group label {
            margin: 0;
            cursor: pointer;
            flex: 1;
        }
        
        .sub-options {
            margin-left: 32px;
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-left: 3px solid #d97706;
            border-radius: 4px;
            display: none;
        }
        
        .sub-options.show {
            display: block;
        }
        
        .price-summary {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            padding: 25px;
            border-radius: 8px;
            margin-top: 25px;
            border: 3px solid #d97706;
            box-shadow: 0 4px 12px rgba(217, 119, 6, 0.2);
        }
        
        .price-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            font-size: 16px;
            color: #92400e;
        }
        
        .price-row.total {
            font-size: 28px;
            font-weight: bold;
            padding-top: 15px;
            border-top: 3px solid #d97706;
            margin-top: 15px;
            color: #92400e;
        }
        
        .itemized-list {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            border: 2px solid #d97706;
        }
        
        .itemized-list h3 {
            color: #d97706;
            margin-bottom: 15px;
            font-size: 18px;
        }
        
        .itemized-item {
            display: flex;
            justify-content: space-between;
            padding: 12px;
            border-bottom: 1px solid #e0e0e0;
            font-size: 15px;
        }
        
        .itemized-item:last-child {
            border-bottom: none;
        }
        
        .itemized-item .item-name {
            color: #333;
            font-weight: 500;
        }
        
        .itemized-item .item-price {
            color: #d97706;
            font-weight: 600;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #b45309 0%, #d97706 100%);
            color: white;
            padding: 16px 32px;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 4px 12px rgba(217, 119, 6, 0.3);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(217, 119, 6, 0.4);
        }
        
        .btn-primary:active {
            transform: translateY(0);
        }
        
        .btn-primary:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .loading-spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 0.8s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .radio-group {
            display: flex;
            gap: 15px;
            margin-top: 10px;
        }
        
        .radio-option {
            display: flex;
            align-items: center;
            padding: 12px 18px;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .radio-option:hover {
            border-color: #d97706;
            background: #fef3c7;
        }
        
        .radio-option input[type="radio"] {
            margin-right: 8px;
            cursor: pointer;
        }
        
        .radio-option label {
            margin: 0;
            cursor: pointer;
            font-weight: normal;
        }
        
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .container {
                border-radius: 8px;
            }
            
            .content {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 36px;
                letter-spacing: 2px;
                gap: 10px;
            }
            
            .header h1 .icon {
                font-size: 32px;
            }
            
            .price-row.total {
                font-size: 24px;
            }
            
            .radio-group {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>
                <span class="icon lightning">‚ö°</span>
                RAPIDO
                <span class="icon">üîß</span>
            </h1>
            <div class="subtitle">Professional Handyman Services</div>
            <p>Lawton, Oklahoma | 6 Years Experience | Get Your Quote Now</p>
            <div class="version">
                <span class="connection-status" id="connectionStatus">
                    <span class="connection-dot"></span>
                    <span id="connectionText">CHECKING...</span>
                </span>
                <span>v2.6</span>
            </div>
        </div>
        
        <div class="content">
            <!-- Success Message -->
            <div id="successMessage" class="success-message">
                <strong>‚úì Quote Request Submitted Successfully!</strong>
                We'll review your request and get back to you within 24 hours with a detailed quote.
            </div>
            
            <!-- Error Message -->
            <div id="errorMessage" class="error-message">
                <span id="errorText"></span>
            </div>
            
            <!-- Info Banner -->
            <div class="info-banner">
                <h3>üè† Welcome to RAPIDO Handyman Services!</h3>
                <p>With 6 years of experience serving Lawton, Oklahoma, we provide quality handyman services at competitive prices.</p>
                <p><strong>Pricing:</strong> $30/hour with a 2-hour minimum for most work. Larger jobs are bid by the job.</p>
                <p><strong>Our Services Include:</strong> Light carpentry, painting, make-ready, property management, hot water systems, water softener systems, light electrical work, window pane and screen replacement, door installation, curb appeal and cosmetic work (residential & commercial), dryer vent clean out and replace, and more!</p>
                <p>üìû Fast Response | üíØ Quality Work | üí∞ Fair Pricing</p>
            </div>
            
            <!-- Disclaimer -->
            <div class="disclaimer">
                <p><strong>Note:</strong> This is an estimate calculator. Final pricing may vary based on project specifics, materials needed, and site conditions. A free on-site consultation will be provided for projects over $500.</p>
            </div>
            
            <form id="quoteForm">
                <!-- Client Information -->
                <div class="section">
                    <div class="section-title">üìã Client Information</div>
                    
                    <div class="form-group">
                        <label>Your Name <span class="required">*</span></label>
                        <input type="text" id="clientName" required placeholder="John Smith">
                    </div>
                    
                    <div class="form-group">
                        <label>Email Address <span class="required">*</span></label>
                        <input type="email" id="clientEmail" required placeholder="john@example.com">
                    </div>
                    
                    <div class="form-group">
                        <label>Phone Number</label>
                        <input type="text" id="clientPhone" placeholder="580-555-1234">
                    </div>
                    
                    <div class="form-group">
                        <label>Service Address</label>
                        <div class="address-autocomplete-wrapper">
                            <input type="text" id="serviceAddress" placeholder="Start typing house number... (e.g., 123)" autocomplete="off">
                            <div id="addressSuggestions" class="address-suggestions"></div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Project Name/Description <span class="required">*</span></label>
                        <input type="text" id="projectName" required placeholder="e.g., Kitchen Cabinet Installation">
                    </div>
                    
                    <div class="form-group">
                        <label>Additional Details</label>
                        <textarea id="projectDescription" placeholder="Describe your project in detail... materials available, timeline preferences, special requirements, etc."></textarea>
                    </div>
                </div>
                
                <!-- Home Interior Services -->
                <div class="section">
                    <div class="section-title">üè† Home Interior Services</div>
                    
                    <div class="checkbox-group">
                        <input type="checkbox" id="kitchenCabinets">
                        <label>Kitchen Cabinet Installation/Hanging <span class="price-note">($40 per cabinet)</span></label>
                    </div>
                    <div id="kitchenCabinetsOptions" class="sub-options">
                        <div class="form-group">
                            <label>Number of Cabinets</label>
                            <input type="number" id="cabinetCount" min="1" max="20" value="5">
                        </div>
                    </div>
                    
                    <div class="checkbox-group">
                        <input type="checkbox" id="bathroomWork">
                        <label>Bathroom Repairs/Updates <span class="price-note">($60-$300)</span></label>
                    </div>
                    <div id="bathroomWorkOptions" class="sub-options">
                        <div class="form-group">
                            <label>Type of Work</label>
                            <select id="bathroomType">
                                <option value="minor">Minor Repairs (Faucet, Toilet, etc.) - $60</option>
                                <option value="moderate">Moderate Updates (Vanity, Fixtures) - $150</option>
                                <option value="major">Major Work (Multiple Items) - $300</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="checkbox-group">
                        <input type="checkbox" id="sheetrock">
                        <label>Sheetrock/Drywall Repair <span class="price-note">($60-$360)</span></label>
                    </div>
                    <div id="sheetrockOptions" class="sub-options">
                        <div class="form-group">
                            <label>Repair Size</label>
                            <select id="sheetrockSize">
                                <option value="small">Small Hole/Patch (< 6") - $60</option>
                                <option value="medium">Medium Repair (6"-24") - $120</option>
                                <option value="large">Large Repair/Multiple Areas - $240</option>
                                <option value="wall">Full Wall - $360</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="checkbox-group">
                        <input type="checkbox" id="interiorPainting">
                        <label>Interior Painting <span class="price-note">($150-$900)</span></label>
                    </div>
                    <div id="interiorPaintingOptions" class="sub-options">
                        <div class="form-group">
                            <label>Area to Paint</label>
                            <select id="interiorPaintArea">
                                <option value="room">Single Room - $150</option>
                                <option value="tworooms">Two Rooms - $270</option>
                                <option value="multiple">Multiple Rooms (3-4) - $480</option>
                                <option value="whole">Whole House Interior - $900</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- Electrical Services -->
                <div class="section">
                    <div class="section-title">‚ö° Electrical Services</div>
                    
                    <div class="checkbox-group">
                        <input type="checkbox" id="floodlights">
                        <label>Floodlight Installation <span class="price-note">($60 per light)</span></label>
                    </div>
                    <div id="floodlightsOptions" class="sub-options">
                        <div class="form-group">
                            <label>Number of Floodlights</label>
                            <input type="number" id="floodlightCount" min="1" max="10" value="2">
                        </div>
                    </div>
                    
                    <div class="checkbox-group">
                        <input type="checkbox" id="lightFixtures">
                        <label>Light Fixture Installation/Replacement <span class="price-note">($50 per fixture)</span></label>
                    </div>
                    <div id="lightFixturesOptions" class="sub-options">
                        <div class="form-group">
                            <label>Number of Fixtures</label>
                            <input type="number" id="fixtureCount" min="1" max="15" value="3">
                        </div>
                    </div>
                    
                    <div class="checkbox-group">
                        <input type="checkbox" id="switches">
                        <label>Wall Switch Replacement <span class="price-note">($60 minimum - 2 hour minimum)</span></label>
                    </div>
                    <div id="switchesOptions" class="sub-options">
                        <div class="form-group">
                            <label>Number of Switches</label>
                            <input type="number" id="switchCount" min="1" max="20" value="2">
                        </div>
                    </div>
                    
                    <div class="checkbox-group">
                        <input type="checkbox" id="outlets">
                        <label>Outlet/Socket Installation/Replacement <span class="price-note">($60 minimum - 2 hour minimum)</span></label>
                    </div>
                    <div id="outletsOptions" class="sub-options">
                        <div class="form-group">
                            <label>Number of Outlets</label>
                            <input type="number" id="outletCount" min="1" max="20" value="2">
                        </div>
                    </div>
                </div>
                
                <!-- Plumbing Services -->
                <div class="section">
                    <div class="section-title">üîß Plumbing Services</div>
                    
                    <div class="checkbox-group">
                        <input type="checkbox" id="plumbing">
                        <label>Plumbing Repairs <span class="price-note">($60-$300)</span></label>
                    </div>
                    <div id="plumbingOptions" class="sub-options">
                        <div class="form-group">
                            <label>Type of Plumbing Work</label>
                            <select id="plumbingType">
                                <option value="minor">Minor Leak/Faucet Repair - $60</option>
                                <option value="fixture">Fixture Replacement - $120</option>
                                <option value="drain">Drain Cleaning/Repair - $90</option>
                                <option value="major">Major Repair/Multiple Issues - $300</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- Outdoor Services -->
                <div class="section">
                    <div class="section-title">üå≥ Outdoor Services</div>
                    
                    <div class="checkbox-group">
                        <input type="checkbox" id="exteriorPainting">
                        <label>Exterior Painting <span class="price-note">($300-$1,500)</span></label>
                    </div>
                    <div id="exteriorPaintingOptions" class="sub-options">
                        <div class="form-group">
                            <label>Exterior Paint Job Size</label>
                            <select id="exteriorPaintSize">
                                <option value="trim">Trim/Accent Only - $300</option>
                                <option value="small">Small Structure (Shed, Garage Door) - $450</option>
                                <option value="partial">Partial House - $750</option>
                                <option value="full">Full House Exterior - $1,500</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="checkbox-group">
                        <input type="checkbox" id="woodFence">
                        <label>Wood Fence Building <span class="price-note">($20-$30 per linear foot)</span></label>
                    </div>
                    <div id="woodFenceOptions" class="sub-options">
                        <div class="form-group">
                            <label>Fence Length (Linear Feet)</label>
                            <input type="number" id="fenceLength" min="10" max="500" value="50">
                        </div>
                        <div class="form-group">
                            <label>Fence Type</label>
                            <select id="fenceType">
                                <option value="basic">Basic Privacy Fence - $20/ft</option>
                                <option value="standard">Standard Quality - $25/ft</option>
                                <option value="premium">Premium/Custom - $30/ft</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="checkbox-group">
                        <input type="checkbox" id="treeService">
                        <label>Small Tree Services (Trimming/Removal) <span class="price-note">($120-$450)</span></label>
                    </div>
                    <div id="treeServiceOptions" class="sub-options">
                        <div class="form-group">
                            <label>Tree Service Type</label>
                            <select id="treeServiceType">
                                <option value="trimming">Tree Trimming (Small) - $120</option>
                                <option value="shrubs">Multiple Shrubs/Small Trees - $180</option>
                                <option value="removal">Small Tree Removal - $300</option>
                                <option value="major">Major Tree Work - $450</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="checkbox-group">
                        <input type="checkbox" id="flowerbeds">
                        <label>Flowerbed Maintenance/Installation <span class="price-note">($60-$300)</span></label>
                    </div>
                    <div id="flowerbedsOptions" class="sub-options">
                        <div class="form-group">
                            <label>Flowerbed Work</label>
                            <select id="flowerbedType">
                                <option value="maintenance">Basic Maintenance/Weeding - $60</option>
                                <option value="refresh">Refresh/New Plants - $120</option>
                                <option value="new">New Flowerbed Installation - $210</option>
                                <option value="multiple">Multiple Beds - $300</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- Yard Work Services -->
                <div class="section">
                    <div class="section-title">üå± Lawn & Yard Work</div>
                    
                    <div class="checkbox-group">
                        <input type="checkbox" id="mowing">
                        <label>Lawn Mowing & Edging <span class="price-note">($60-$120 per visit)</span></label>
                    </div>
                    <div id="mowingOptions" class="sub-options">
                        <div class="form-group">
                            <label>Lawn Size</label>
                            <select id="lawnSize">
                                <option value="small">Small Yard (< 5,000 sq ft) - $60</option>
                                <option value="medium">Medium Yard (5,000-10,000 sq ft) - $75</option>
                                <option value="large">Large Yard (10,000-15,000 sq ft) - $90</option>
                                <option value="xlarge">Extra Large Yard (> 15,000 sq ft) - $120</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Frequency (optional)</label>
                            <select id="mowingFrequency">
                                <option value="onetime">One-Time Service</option>
                                <option value="weekly">Weekly (10% discount)</option>
                                <option value="biweekly">Bi-Weekly (5% discount)</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="checkbox-group">
                        <input type="checkbox" id="yardCleanup">
                        <label>General Yard Cleanup <span class="price-note">($60-$240)</span></label>
                    </div>
                    <div id="yardCleanupOptions" class="sub-options">
                        <div class="form-group">
                            <label>Cleanup Scope</label>
                            <select id="cleanupScope">
                                <option value="light">Light Cleanup (Leaves, Debris) - $60</option>
                                <option value="moderate">Moderate Cleanup - $150</option>
                                <option value="heavy">Heavy Cleanup - $240</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- Additional Options -->
                <div class="section">
                    <div class="section-title">‚ö° Additional Options</div>
                    
                    <div class="checkbox-group">
                        <input type="checkbox" id="urgent">
                        <label><strong>üö® URGENT SERVICE (Next Day) +25%</strong></label>
                    </div>
                    
                    <div class="checkbox-group">
                        <input type="checkbox" id="generalMaintenance" onchange="updatePrice(); updateItemizedList()">
                        <label><strong>üîß General Maintenance Services</strong></label>
                        <div class="input-group" style="margin-top: 10px;">
                            <label>Hours Needed:</label>
                            <input type="number" id="maintenanceHours" min="1" max="40" value="2" onchange="updatePrice(); updateItemizedList()">
                        </div>
                        <small style="display: block; margin-top: 5px; color: #666; font-style: italic;">
                            üí° $30/hour rate for general handyman tasks, repairs, and maintenance work
                        </small>
                    </div>

                </div>
                
                <!-- Price Summary -->
                <div class="price-summary">
                    <div class="price-row">
                        <span>Base Services:</span>
                        <span id="basePrice">$0</span>
                    </div>

                    <div class="price-row" id="urgentRow" style="display: none;">
                        <span>Urgent Service Fee (+25%):</span>
                        <span id="urgentPrice">$0</span>
                    </div>
                    <div class="price-row" id="discountRow" style="display: none; color: #28a745;">
                        <span>Recurring Service Discount:</span>
                        <span id="discountAmount">-$0</span>
                    </div>
                    <div class="price-row total">
                        <span>ESTIMATED TOTAL:</span>
                        <span id="totalPrice">$0</span>
                    </div>
                </div>
                
                <!-- Itemized List -->
                <div class="itemized-list">
                    <h3>üìù Selected Services Breakdown</h3>
                    <div id="itemizedContainer">
                        <div style="text-align: center; color: #999; padding: 20px;">
                            Select services above to see itemized breakdown
                        </div>
                    </div>
                </div>
                
                <!-- Submit Button -->
                <button type="submit" class="btn-primary" id="submitBtn">
                    Submit Quote Request
                </button>
            </form>
        </div>
    </div>
    
    <script>
        // Add click handlers to all checkbox groups after page loads
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.checkbox-group').forEach(group => {
                group.addEventListener('click', function(e) {
                    // Only toggle if we didn't click directly on the checkbox or label
                    if (e.target.type !== 'checkbox' && e.target.tagName !== 'LABEL') {
                        const checkbox = this.querySelector('input[type="checkbox"]');
                        if (checkbox) {
                            checkbox.checked = !checkbox.checked;
                            checkbox.dispatchEvent(new Event('change'));
                        }
                    }
                });
            });
        });
        
        // Show/hide sub-options based on checkbox state
        document.querySelectorAll('.checkbox-group input[type="checkbox"]').forEach(checkbox => {
            checkbox.addEventListener('change', function(e) {
                const optionsDiv = document.getElementById(this.id + 'Options');
                if (optionsDiv) {
                    if (this.checked) {
                        optionsDiv.classList.add('show');
                    } else {
                        optionsDiv.classList.remove('show');
                    }
                }
                calculatePrice();
                updateItemizedList();
            });
        });
        
        // Calculate pricing
        function calculatePrice() {
            let baseTotal = 0;
            
            // Kitchen Cabinets
            if (document.getElementById('kitchenCabinets').checked) {
                const count = parseInt(document.getElementById('cabinetCount').value) || 5;
                // $40 per cabinet
                baseTotal += count * 40;
            }
            
            // Bathroom Work
            if (document.getElementById('bathroomWork').checked) {
                const type = document.getElementById('bathroomType').value;
                const prices = { minor: 60, moderate: 150, major: 300 };
                baseTotal += prices[type] || 0;
            }
            
            // Sheetrock
            if (document.getElementById('sheetrock').checked) {
                const size = document.getElementById('sheetrockSize').value;
                const prices = { small: 60, medium: 120, large: 240, wall: 360 };
                baseTotal += prices[size] || 0;
            }
            
            // Interior Painting
            if (document.getElementById('interiorPainting').checked) {
                const area = document.getElementById('interiorPaintArea').value;
                const prices = { room: 150, tworooms: 270, multiple: 480, whole: 900 };
                baseTotal += prices[area] || 0;
            }
            
            // Floodlights
            if (document.getElementById('floodlights').checked) {
                const count = parseInt(document.getElementById('floodlightCount').value) || 2;
                baseTotal += count * 60;
            }
            
            // Light Fixtures
            if (document.getElementById('lightFixtures').checked) {
                const count = parseInt(document.getElementById('fixtureCount').value) || 3;
                baseTotal += count * 50;
            }
            
            // Switches
            if (document.getElementById('switches').checked) {
                const count = parseInt(document.getElementById('switchCount').value) || 2;
                baseTotal += 60; // 2-hour minimum
            }
            
            // Outlets
            if (document.getElementById('outlets').checked) {
                const count = parseInt(document.getElementById('outletCount').value) || 2;
                baseTotal += 60; // 2-hour minimum
            }
            
            // Plumbing
            if (document.getElementById('plumbing').checked) {
                const type = document.getElementById('plumbingType').value;
                const prices = { minor: 60, fixture: 120, drain: 90, major: 360 };
                baseTotal += prices[type] || 0;
            }
            
            // Exterior Painting
            if (document.getElementById('exteriorPainting').checked) {
                const size = document.getElementById('exteriorPaintSize').value;
                const prices = { trim: 300, small: 450, partial: 750, full: 1500 };
                baseTotal += prices[size] || 0;
            }
            
            // Wood Fence
            if (document.getElementById('woodFence').checked) {
                const length = parseInt(document.getElementById('fenceLength').value) || 50;
                const type = document.getElementById('fenceType').value;
                const rates = { basic: 20, standard: 25, premium: 30 };
                baseTotal += length * (rates[type] || 25);
            }
            
            // Tree Service
            if (document.getElementById('treeService').checked) {
                const type = document.getElementById('treeServiceType').value;
                const prices = { trimming: 120, shrubs: 180, removal: 300, major: 450 };
                baseTotal += prices[type] || 0;
            }
            
            // Flowerbeds
            if (document.getElementById('flowerbeds').checked) {
                const type = document.getElementById('flowerbedType').value;
                const prices = { maintenance: 60, refresh: 120, new: 210, multiple: 300 };
                baseTotal += prices[type] || 0;
            }
            
            // Mowing
            if (document.getElementById('mowing').checked) {
                const size = document.getElementById('lawnSize').value;
                const prices = { small: 60, medium: 75, large: 90, xlarge: 120 };
                let mowingPrice = prices[size] || 0;
                
                // Apply frequency discount
                const frequency = document.getElementById('mowingFrequency').value;
                if (frequency === 'weekly') {
                    mowingPrice *= 0.9; // 10% discount
                } else if (frequency === 'biweekly') {
                    mowingPrice *= 0.95; // 5% discount
                }
                
                baseTotal += mowingPrice;
            }
            
            // Yard Cleanup
            if (document.getElementById('yardCleanup').checked) {
                const scope = document.getElementById('cleanupScope').value;
                const prices = { light: 60, moderate: 150, heavy: 240 };
                baseTotal += prices[scope] || 0;
            }
            
            // General Maintenance Services
            if (document.getElementById('generalMaintenance').checked) {
                const hours = parseInt(document.getElementById('maintenanceHours').value) || 2;
                baseTotal += hours * 30;
            }
            
            // Calculate totals
            let subtotal = baseTotal;
            let urgentFee = 0;
            let finalTotal = subtotal;
            
            // Urgent service fee
            if (document.getElementById('urgent').checked) {
                urgentFee = Math.round(subtotal * 0.25);
                finalTotal = subtotal + urgentFee;
                
                // Round UP to nearest $5 for cleaner pricing
                finalTotal = Math.ceil(finalTotal / 5) * 5;
                
                // Recalculate urgentFee to match rounded total
                urgentFee = finalTotal - subtotal;
                
                document.getElementById('urgentRow').style.display = 'flex';
            } else {
                document.getElementById('urgentRow').style.display = 'none';
            }
            
            // Update display
            document.getElementById('basePrice').textContent = '$' + baseTotal.toLocaleString();
            document.getElementById('urgentPrice').textContent = '$' + urgentFee.toLocaleString();
            document.getElementById('totalPrice').textContent = '$' + finalTotal.toLocaleString();
        }
        
        // Update itemized list
        function updateItemizedList() {
            const container = document.getElementById('itemizedContainer');
            const items = [];
            
            // Kitchen Cabinets
            if (document.getElementById('kitchenCabinets').checked) {
                const count = parseInt(document.getElementById('cabinetCount').value) || 5;
                const price = count * 40;
                items.push({ name: `Kitchen Cabinet Installation (${count} cabinets @ $40 each)`, price: price });
            }
            
            // Bathroom Work
            if (document.getElementById('bathroomWork').checked) {
                const type = document.getElementById('bathroomType').value;
                const prices = { minor: 60, moderate: 150, major: 300 };
                const labels = { 
                    minor: 'Minor Bathroom Repairs', 
                    moderate: 'Moderate Bathroom Updates', 
                    major: 'Major Bathroom Work' 
                };
                items.push({ name: labels[type], price: prices[type] });
            }
            
            // Sheetrock
            if (document.getElementById('sheetrock').checked) {
                const size = document.getElementById('sheetrockSize').value;
                const prices = { small: 60, medium: 120, large: 240, wall: 360 };
                const labels = { 
                    small: 'Small Sheetrock Patch', 
                    medium: 'Medium Drywall Repair', 
                    large: 'Large Drywall Repair', 
                    wall: 'Full Wall Sheetrock' 
                };
                items.push({ name: labels[size], price: prices[size] });
            }
            
            // Interior Painting
            if (document.getElementById('interiorPainting').checked) {
                const area = document.getElementById('interiorPaintArea').value;
                const prices = { room: 150, tworooms: 270, multiple: 480, whole: 900 };
                const labels = { 
                    room: 'Interior Painting - Single Room', 
                    tworooms: 'Interior Painting - Two Rooms', 
                    multiple: 'Interior Painting - Multiple Rooms', 
                    whole: 'Interior Painting - Whole House' 
                };
                items.push({ name: labels[area], price: prices[area] });
            }
            
            // Floodlights
            if (document.getElementById('floodlights').checked) {
                const count = parseInt(document.getElementById('floodlightCount').value) || 2;
                const price = count * 60;
                items.push({ name: `Floodlight Installation (${count} lights @ $60 each)`, price: price });
            }
            
            // Light Fixtures
            if (document.getElementById('lightFixtures').checked) {
                const count = parseInt(document.getElementById('fixtureCount').value) || 3;
                const price = count * 50;
                items.push({ name: `Light Fixture Installation (${count} fixtures @ $50 each)`, price: price });
            }
            
            // Switches
            if (document.getElementById('switches').checked) {
                const count = parseInt(document.getElementById('switchCount').value) || 2;
                const price = 60;
                items.push({ name: `Wall Switch Replacement ($60 minimum - 2 hours)`, price: price });
            }
            
            // Outlets
            if (document.getElementById('outlets').checked) {
                const count = parseInt(document.getElementById('outletCount').value) || 2;
                const price = 60;
                items.push({ name: `Outlet Installation/Replacement ($60 minimum - 2 hours)`, price: price });
            }
            
            // Plumbing
            if (document.getElementById('plumbing').checked) {
                const type = document.getElementById('plumbingType').value;
                const prices = { minor: 60, fixture: 120, drain: 90, major: 360 };
                const labels = { 
                    minor: 'Minor Plumbing Repair', 
                    fixture: 'Plumbing Fixture Replacement', 
                    drain: 'Drain Cleaning/Repair', 
                    major: 'Major Plumbing Work' 
                };
                items.push({ name: labels[type], price: prices[type] });
            }
            
            // Exterior Painting
            if (document.getElementById('exteriorPainting').checked) {
                const size = document.getElementById('exteriorPaintSize').value;
                const prices = { trim: 300, small: 450, partial: 750, full: 1500 };
                const labels = { 
                    trim: 'Exterior Painting - Trim/Accent', 
                    small: 'Exterior Painting - Small Structure', 
                    partial: 'Exterior Painting - Partial House', 
                    full: 'Exterior Painting - Full House' 
                };
                items.push({ name: labels[size], price: prices[size] });
            }
            
            // Wood Fence
            if (document.getElementById('woodFence').checked) {
                const length = parseInt(document.getElementById('fenceLength').value) || 50;
                const type = document.getElementById('fenceType').value;
                const rates = { basic: 20, standard: 25, premium: 30 };
                const labels = { basic: 'Basic', standard: 'Standard', premium: 'Premium' };
                const rate = rates[type] || 25;
                const price = length * rate;
                items.push({ name: `Wood Fence - ${labels[type]} (${length} ft @ $${rate}/ft)`, price: price });
            }
            
            // Tree Service
            if (document.getElementById('treeService').checked) {
                const type = document.getElementById('treeServiceType').value;
                const prices = { trimming: 120, shrubs: 180, removal: 300, major: 450 };
                const labels = { 
                    trimming: 'Tree Trimming', 
                    shrubs: 'Shrubs/Small Trees Service', 
                    removal: 'Small Tree Removal', 
                    major: 'Major Tree Work' 
                };
                items.push({ name: labels[type], price: prices[type] });
            }
            
            // Flowerbeds
            if (document.getElementById('flowerbeds').checked) {
                const type = document.getElementById('flowerbedType').value;
                const prices = { maintenance: 60, refresh: 120, new: 210, multiple: 300 };
                const labels = { 
                    maintenance: 'Flowerbed Maintenance', 
                    refresh: 'Flowerbed Refresh', 
                    new: 'New Flowerbed Installation', 
                    multiple: 'Multiple Flowerbeds' 
                };
                items.push({ name: labels[type], price: prices[type] });
            }
            
            // Mowing
            if (document.getElementById('mowing').checked) {
                const size = document.getElementById('lawnSize').value;
                const prices = { small: 60, medium: 75, large: 90, xlarge: 120 };
                const labels = { 
                    small: 'Lawn Mowing - Small Yard', 
                    medium: 'Lawn Mowing - Medium Yard', 
                    large: 'Lawn Mowing - Large Yard', 
                    xlarge: 'Lawn Mowing - Extra Large Yard' 
                };
                let mowingPrice = prices[size] || 0;
                const frequency = document.getElementById('mowingFrequency').value;
                let freqLabel = '';
                
                if (frequency === 'weekly') {
                    mowingPrice *= 0.9;
                    freqLabel = ' (Weekly - 10% discount)';
                } else if (frequency === 'biweekly') {
                    mowingPrice *= 0.95;
                    freqLabel = ' (Bi-Weekly - 5% discount)';
                }
                
                items.push({ name: labels[size] + freqLabel, price: Math.round(mowingPrice) });
            }
            
            // Yard Cleanup
            if (document.getElementById('yardCleanup').checked) {
                const scope = document.getElementById('cleanupScope').value;
                const prices = { light: 60, moderate: 150, heavy: 240 };
                const labels = { 
                    light: 'Light Yard Cleanup', 
                    moderate: 'Moderate Yard Cleanup', 
                    heavy: 'Heavy Yard Cleanup' 
                };
                items.push({ name: labels[scope], price: prices[scope] });
            }
            
            // General Maintenance Services
            if (document.getElementById('generalMaintenance').checked) {
                const hours = parseInt(document.getElementById('maintenanceHours').value) || 2;
                const price = hours * 30;
                items.push({ name: `General Maintenance Services (${hours} hours @ $30/hour)`, price: price });
            }
            
            // Urgent Fee
            if (document.getElementById('urgent').checked && items.length > 0) {
                const subtotal = items.reduce((sum, item) => sum + item.price, 0);
                const urgentFee = Math.round(subtotal * 0.25);
                items.push({ name: 'üö® Urgent Service Fee (+25%)', price: urgentFee });
            }
            
            // Display items
            if (items.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: #999; padding: 20px;">Select services above to see itemized breakdown</div>';
            } else {
                container.innerHTML = items.map(item => `
                    <div class="itemized-item">
                        <span class="item-name">${item.name}</span>
                        <span class="item-price">$${item.price.toLocaleString()}</span>
                    </div>
                `).join('');
            }
        }
        
        // Initialize
        calculatePrice();
        updateItemizedList();
        
        // Initialize FREE Address Autocomplete (no API key needed!)
        // Smart local database for Lawton, OK area (20-mile radius)
        // COMPREHENSIVE DATABASE - Programmatically generated for complete coverage
        
        function generateLawtonStreetDatabase() {
            const database = {
                subdivisions: [],
                streets: [],
                towns: []
            };
            
            // Major Subdivisions & Neighborhoods
            database.subdivisions = [
                'Oak Ridge, Lawton, OK',
                'Quail Creek, Lawton, OK',
                'Cottonwood Creek, Lawton, OK',
                'Hidden Valley, Lawton, OK',
                'Sheridan Estates, Lawton, OK',
                'Eastgate, Lawton, OK',
                'Lake Ellsworth Estates, Lawton, OK',
                'Cameron University Area, Lawton, OK',
                'Highland Park, Lawton, OK',
                'Woodland Hills, Lawton, OK',
                'Paradise Estates, Lawton, OK',
                'Northridge, Lawton, OK',
                'Westgate, Lawton, OK',
                'Southgate, Lawton, OK',
                'Heritage Hills, Lawton, OK',
                'Country Club Estates, Lawton, OK',
                'Garden Valley, Lawton, OK',
                'Meadowbrook, Lawton, OK',
                'Scissortail, Lawton, OK',
                'Ridgecrest, Lawton, OK',
                'Carriage Hills, Lawton, OK',
                'Pioneer Park, Lawton, OK'
            ];
            
            // MAJOR ROADS with multiple quadrants (known to exist)
            const majorRoadsWithQuadrants = [
                'Cache Rd', 'Lee Blvd', 'Gore Blvd', 'Fort Sill Blvd',
                'Bishop Rd', 'Sheridan Rd'
            ];
            
            const quadrants = ['NW', 'NE', 'SW', 'SE'];
            majorRoadsWithQuadrants.forEach(road => {
                quadrants.forEach(quad => {
                    database.streets.push(`${quad} ${road}, Lawton, OK`);
                });
            });
            
            // Named Streets/Avenues WITHOUT quadrants (user adds quadrant with house number)
            const namedStreets = [
                'Ferris Ave', 'Arlington Ave', 'Baldwin Ave', 'Williams Ave',
                'Dearborn Ave', 'Columbia Ave', 'Bell Ave', 'Lincoln Ave',
                'Oklahoma Ave', 'Bessie Ave', 'Rogers Ln', 'Flower Mound Rd',
                'Summit View Rd', 'Wolf Creek Rd', 'Homestead Dr', 'Delta Ave',
                'Warwick Way', 'Angus Pl'
            ];
            
            namedStreets.forEach(street => {
                database.streets.push(`${street}, Lawton, OK`);
            });
            
            // Oklahoma State Highways serving Lawton area
            const stateHighways = [
                'OK 7', 'OK 17', 'OK 36', 'OK 49', 'OK 58', 'OK 115', 'OK 281',
                'State Highway 7', 'State Highway 17', 'State Highway 36', 
                'State Highway 49', 'State Highway 58', 'State Highway 115', 
                'State Highway 281'
            ];
            
            stateHighways.forEach(highway => {
                database.streets.push(`${highway}, Lawton, OK`);
            });
            
            // Generate ALL NUMBERED STREETS (2nd through 90th) WITHOUT quadrants
            // User adds quadrant when typing house number
            for (let num = 2; num <= 90; num++) {
                const suffix = num === 2 ? '2nd' : num === 3 ? '3rd' : num === 21 ? '21st' : 
                             num === 22 ? '22nd' : num === 23 ? '23rd' : num === 31 ? '31st' :
                             num === 32 ? '32nd' : num === 33 ? '33rd' : num === 41 ? '41st' :
                             num === 42 ? '42nd' : num === 43 ? '43rd' : num === 51 ? '51st' :
                             num === 52 ? '52nd' : num === 53 ? '53rd' : num === 61 ? '61st' :
                             num === 62 ? '62nd' : num === 63 ? '63rd' : num === 71 ? '71st' :
                             num === 72 ? '72nd' : num === 73 ? '73rd' : num === 81 ? '81st' :
                             num === 82 ? '82nd' : num === 83 ? '83rd' : `${num}th`;
                
                database.streets.push(`${suffix} St, Lawton, OK`);
            }
            
            // Generate ALL LETTERED AVENUES (A through Z) WITHOUT quadrants
            // User adds quadrant when typing house number
            const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('');
            letters.forEach(letter => {
                database.streets.push(`${letter} Ave, Lawton, OK`);
            });
            
            // Surrounding Towns (within 20-mile radius) with their main streets
            database.towns = [
                'Lawton, OK',
                // Cache, OK
                'Main St, Cache, OK',
                'Cache Rd, Cache, OK',
                'Highway 115, Cache, OK',
                'Cache Creek Rd, Cache, OK',
                // Elgin, OK
                'Main St, Elgin, OK',
                'Broadway, Elgin, OK',
                'Highway 17, Elgin, OK',
                'Elgin Rd, Elgin, OK',
                // Fletcher, OK
                'Main St, Fletcher, OK',
                'Highway 7, Fletcher, OK',
                'Fletcher Ave, Fletcher, OK',
                // Medicine Park, OK
                'Main St, Medicine Park, OK',
                'Bath House Row, Medicine Park, OK',
                'Highway 49, Medicine Park, OK',
                'Medicine Park Rd, Medicine Park, OK',
                // Geronimo, OK
                'Main St, Geronimo, OK',
                'Highway 281, Geronimo, OK',
                'Geronimo Rd, Geronimo, OK',
                // Indiahoma, OK
                'Main St, Indiahoma, OK',
                'Highway 49, Indiahoma, OK',
                // Chattanooga, OK
                'Main St, Chattanooga, OK',
                'Highway 36, Chattanooga, OK',
                // Fort Sill, OK
                'Fort Sill Gate, Fort Sill, OK',
                'Fort Sill Blvd, Fort Sill, OK',
                // Faxon, OK
                'Main St, Faxon, OK',
                // Sterling, OK
                'Main St, Sterling, OK'
            ];
            
            return database;
        }
        
        // Generate comprehensive database
        const lawtonAddressDatabase = generateLawtonStreetDatabase();
        
        // Flatten all addresses into one searchable array
        const allAddresses = [
            ...lawtonAddressDatabase.subdivisions,
            ...lawtonAddressDatabase.streets,
            ...lawtonAddressDatabase.towns
        ];
        
        // Smart Address Autocomplete Implementation
        function initAddressAutocomplete() {
            const input = document.getElementById('serviceAddress');
            const suggestionsDiv = document.getElementById('addressSuggestions');
            let selectedIndex = -1;
            let currentSuggestions = [];
            
            // Load saved addresses from localStorage
            function getSavedAddresses() {
                return JSON.parse(localStorage.getItem('rapidoAddresses') || '[]');
            }
            
            // Filter and display suggestions
            function showSuggestions(value) {
                if (!value || value.length < 1) {
                    suggestionsDiv.classList.remove('show');
                    return;
                }
                
                // Extract house number if present (digits at start)
                const houseNumberMatch = value.match(/^(\d+)\s*/);
                const houseNumber = houseNumberMatch ? houseNumberMatch[1] : '';
                const searchTerm = houseNumber ? value.substring(houseNumber.length).trim().toLowerCase() : value.toLowerCase();
                
                // Combine saved addresses with database
                const savedAddresses = getSavedAddresses();
                const combinedAddresses = [...new Set([...savedAddresses, ...allAddresses])];
                
                // Filter suggestions
                let filteredSuggestions = combinedAddresses.filter(addr => 
                    addr.toLowerCase().includes(searchTerm)
                );
                
                // INTELLIGENT SORTING - Best matches at the top!
                filteredSuggestions.sort((a, b) => {
                    const aLower = a.toLowerCase();
                    const bLower = b.toLowerCase();
                    
                    // Get the main street/avenue name (before the comma)
                    const aMain = aLower.split(',')[0].trim();
                    const bMain = bLower.split(',')[0].trim();
                    
                    // Check if it's a street/avenue/road vs subdivision
                    const aIsStreet = lawtonAddressDatabase.streets.includes(a);
                    const bIsStreet = lawtonAddressDatabase.streets.includes(b);
                    const aIsSubdivision = lawtonAddressDatabase.subdivisions.includes(a);
                    const bIsSubdivision = lawtonAddressDatabase.subdivisions.includes(b);
                    
                    // Priority 1: Exact start match on main street name
                    const aStartsWithSearch = aMain.startsWith(searchTerm);
                    const bStartsWithSearch = bMain.startsWith(searchTerm);
                    
                    if (aStartsWithSearch && !bStartsWithSearch) return -1;
                    if (!aStartsWithSearch && bStartsWithSearch) return 1;
                    
                    // Priority 2: If search contains street/ave/rd keywords, prioritize streets over subdivisions
                    const streetKeywords = ['st', 'ave', 'rd', 'blvd', 'ln', 'dr', 'way', 'pl'];
                    const searchHasStreetKeyword = streetKeywords.some(kw => searchTerm.includes(kw));
                    
                    if (searchHasStreetKeyword) {
                        if (aIsStreet && !bIsStreet) return -1;
                        if (!aIsStreet && bIsStreet) return 1;
                    }
                    
                    // Priority 3: Recent/saved addresses come first
                    const aIsRecent = savedAddresses.includes(a);
                    const bIsRecent = savedAddresses.includes(b);
                    
                    if (aIsRecent && !bIsRecent) return -1;
                    if (!aIsRecent && bIsRecent) return 1;
                    
                    // Priority 4: Streets before subdivisions (when both match equally)
                    if (aIsStreet && aIsSubdivision) return -1;
                    if (!aIsStreet && bIsSubdivision) return 1;
                    
                    // Priority 5: Check if search term appears earlier in the string
                    const aIndex = aLower.indexOf(searchTerm);
                    const bIndex = bLower.indexOf(searchTerm);
                    
                    if (aIndex !== bIndex) return aIndex - bIndex;
                    
                    // Priority 6: Shorter addresses first (more specific)
                    return a.length - b.length;
                });
                
                // Limit to top 10 best matches
                currentSuggestions = filteredSuggestions.slice(0, 10);
                
                if (currentSuggestions.length === 0) {
                    suggestionsDiv.classList.remove('show');
                    return;
                }
                
                // Build suggestions HTML
                let html = '';
                currentSuggestions.forEach((addr, index) => {
                    const displayAddr = houseNumber ? `${houseNumber} ${addr}` : addr;
                    const type = savedAddresses.includes(addr) ? 'Recent' : 
                                lawtonAddressDatabase.subdivisions.includes(addr) ? 'Subdivision' :
                                lawtonAddressDatabase.streets.includes(addr) ? 'Street' : 'Area';
                    
                    html += `<div class="address-suggestion-item" data-index="${index}">
                        <div class="suggestion-type">${type}</div>
                        <div>${displayAddr}</div>
                    </div>`;
                });
                
                suggestionsDiv.innerHTML = html;
                suggestionsDiv.classList.add('show');
                selectedIndex = -1;
                
                // Add click handlers
                suggestionsDiv.querySelectorAll('.address-suggestion-item').forEach((item, index) => {
                    item.addEventListener('click', () => selectSuggestion(index));
                });
            }
            
            // Select a suggestion
            function selectSuggestion(index) {
                if (index >= 0 && index < currentSuggestions.length) {
                    const selected = currentSuggestions[index];
                    const houseNumberMatch = input.value.match(/^(\d+)\s*/);
                    const houseNumber = houseNumberMatch ? houseNumberMatch[1] : '';
                    
                    input.value = houseNumber ? `${houseNumber} ${selected}` : selected;
                    suggestionsDiv.classList.remove('show');
                    selectedIndex = -1;
                }
            }
            
            // Keyboard navigation
            function updateSelection(newIndex) {
                const items = suggestionsDiv.querySelectorAll('.address-suggestion-item');
                
                // Remove old selection
                if (selectedIndex >= 0 && selectedIndex < items.length) {
                    items[selectedIndex].classList.remove('selected');
                }
                
                // Add new selection
                selectedIndex = newIndex;
                if (selectedIndex >= 0 && selectedIndex < items.length) {
                    items[selectedIndex].classList.add('selected');
                    items[selectedIndex].scrollIntoView({ block: 'nearest' });
                }
            }
            
            // Event listeners
            input.addEventListener('input', (e) => {
                showSuggestions(e.target.value);
            });
            
            input.addEventListener('keydown', (e) => {
                const items = suggestionsDiv.querySelectorAll('.address-suggestion-item');
                
                if (e.key === 'ArrowDown') {
                    e.preventDefault();
                    if (selectedIndex < items.length - 1) {
                        updateSelection(selectedIndex + 1);
                    }
                } else if (e.key === 'ArrowUp') {
                    e.preventDefault();
                    if (selectedIndex > 0) {
                        updateSelection(selectedIndex - 1);
                    } else {
                        updateSelection(-1);
                    }
                } else if (e.key === 'Enter') {
                    if (selectedIndex >= 0) {
                        e.preventDefault();
                        selectSuggestion(selectedIndex);
                    }
                } else if (e.key === 'Escape') {
                    suggestionsDiv.classList.remove('show');
                    selectedIndex = -1;
                }
            });
            
            // Close suggestions when clicking outside
            document.addEventListener('click', (e) => {
                if (!input.contains(e.target) && !suggestionsDiv.contains(e.target)) {
                    suggestionsDiv.classList.remove('show');
                    selectedIndex = -1;
                }
            });
            
            // Focus input border when suggestions are shown
            input.addEventListener('focus', () => {
                if (input.value) {
                    showSuggestions(input.value);
                }
            });
        }
        
        // Save address to history when form is submitted
        function saveAddressToHistory(address) {
            if (address && address.trim()) {
                const savedAddresses = JSON.parse(localStorage.getItem('rapidoAddresses') || '[]');
                if (!savedAddresses.includes(address)) {
                    savedAddresses.unshift(address); // Add to beginning
                    // Keep only last 20 addresses
                    if (savedAddresses.length > 20) {
                        savedAddresses.pop();
                    }
                    localStorage.setItem('rapidoAddresses', JSON.stringify(savedAddresses));
                }
            }
        }
        
        // Initialize on page load
        initAddressAutocomplete();
        
        // Check Firebase connection status
        function checkFirebaseConnection() {
            const statusElement = document.getElementById('connectionStatus');
            const textElement = document.getElementById('connectionText');
            
            // Test Firebase connection
            const connectedRef = firebase.database().ref('.info/connected');
            connectedRef.on('value', (snapshot) => {
                if (snapshot.val() === true) {
                    // Connected
                    statusElement.classList.remove('offline');
                    statusElement.classList.add('online');
                    textElement.textContent = 'ONLINE';
                } else {
                    // Disconnected
                    statusElement.classList.remove('online');
                    statusElement.classList.add('offline');
                    textElement.textContent = 'OFFLINE';
                }
            });
        }
        
        // Check connection on page load
        checkFirebaseConnection();
        
        // Phone number auto-formatting
        function formatPhoneNumber(value) {
            // Remove all non-numeric characters
            const numbers = value.replace(/\D/g, '');
            
            // Limit to 10 digits
            const limited = numbers.substring(0, 10);
            
            // Apply formatting: XXX-XXX-XXXX
            if (limited.length <= 3) {
                return limited;
            } else if (limited.length <= 6) {
                return limited.substring(0, 3) + '-' + limited.substring(3);
            } else {
                return limited.substring(0, 3) + '-' + limited.substring(3, 6) + '-' + limited.substring(6);
            }
        }
        
        // Add phone formatting event listener
        document.getElementById('clientPhone').addEventListener('input', function(e) {
            const cursorPosition = e.target.selectionStart;
            const oldValue = e.target.value;
            const oldLength = oldValue.length;
            
            // Format the phone number
            const formatted = formatPhoneNumber(oldValue);
            e.target.value = formatted;
            
            // Adjust cursor position to account for auto-added dashes
            const newLength = formatted.length;
            const lengthDiff = newLength - oldLength;
            
            if (lengthDiff > 0) {
                // Dash was added, move cursor forward
                e.target.selectionStart = e.target.selectionEnd = cursorPosition + lengthDiff;
            } else {
                // Keep cursor in same position
                e.target.selectionStart = e.target.selectionEnd = cursorPosition;
            }
        });
        
        // Auto-update on changes
        document.getElementById('quoteForm').addEventListener('change', function() {
            calculatePrice();
            updateItemizedList();
        });
        
        document.getElementById('quoteForm').addEventListener('input', function() {
            calculatePrice();
            updateItemizedList();
        });
        
        // Form submission
        document.getElementById('quoteForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitBtn = document.getElementById('submitBtn');
            const successMsg = document.getElementById('successMessage');
            const errorMsg = document.getElementById('errorMessage');
            
            // Hide messages
            successMsg.classList.remove('show');
            errorMsg.classList.remove('show');
            
            // Validate
            const clientName = document.getElementById('clientName').value.trim();
            const clientEmail = document.getElementById('clientEmail').value.trim();
            const projectName = document.getElementById('projectName').value.trim();
            
            if (!clientName || !clientEmail || !projectName) {
                document.getElementById('errorText').textContent = 'Please fill in all required fields (*)';
                errorMsg.classList.add('show');
                return;
            }
            
            // Disable button
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<div class="loading-spinner"></div> Submitting...';
            
            try {
                // Check Firebase connection
                if (!database) {
                    throw new Error('Firebase not initialized. Please check your configuration.');
                }
                
                // Generate invoice number
                const now = new Date();
                const year = String(now.getFullYear()).slice(-2);
                const month = String(now.getMonth() + 1).padStart(2, '0');
                const day = String(now.getDate()).padStart(2, '0');
                const hours = String(now.getHours()).padStart(2, '0');
                const minutes = String(now.getMinutes()).padStart(2, '0');
                const invoiceNumber = `RAPIDO-${year}${month}${day}-${hours}${minutes}`;
                
                // Build services description
                const services = [];
                
                if (document.getElementById('kitchenCabinets').checked) {
                    const count = document.getElementById('cabinetCount').value;
                    services.push(`Kitchen Cabinet Installation - ${count} cabinets`);
                }
                if (document.getElementById('bathroomWork').checked) {
                    const type = document.getElementById('bathroomType').value;
                    services.push(`Bathroom Work - ${type}`);
                }
                if (document.getElementById('sheetrock').checked) {
                    const size = document.getElementById('sheetrockSize').value;
                    services.push(`Sheetrock Repair - ${size}`);
                }
                if (document.getElementById('interiorPainting').checked) {
                    const area = document.getElementById('interiorPaintArea').value;
                    services.push(`Interior Painting - ${area}`);
                }
                if (document.getElementById('floodlights').checked) {
                    const count = document.getElementById('floodlightCount').value;
                    services.push(`Floodlight Installation - ${count} lights`);
                }
                if (document.getElementById('lightFixtures').checked) {
                    const count = document.getElementById('fixtureCount').value;
                    services.push(`Light Fixtures - ${count} fixtures`);
                }
                if (document.getElementById('switches').checked) {
                    const count = document.getElementById('switchCount').value;
                    services.push(`Wall Switches - ${count} switches`);
                }
                if (document.getElementById('outlets').checked) {
                    const count = document.getElementById('outletCount').value;
                    services.push(`Outlets - ${count} outlets`);
                }
                if (document.getElementById('plumbing').checked) {
                    const type = document.getElementById('plumbingType').value;
                    services.push(`Plumbing - ${type}`);
                }
                if (document.getElementById('exteriorPainting').checked) {
                    const size = document.getElementById('exteriorPaintSize').value;
                    services.push(`Exterior Painting - ${size}`);
                }
                if (document.getElementById('woodFence').checked) {
                    const length = document.getElementById('fenceLength').value;
                    const type = document.getElementById('fenceType').value;
                    services.push(`Wood Fence - ${length}ft ${type}`);
                }
                if (document.getElementById('treeService').checked) {
                    const type = document.getElementById('treeServiceType').value;
                    services.push(`Tree Service - ${type}`);
                }
                if (document.getElementById('flowerbeds').checked) {
                    const type = document.getElementById('flowerbedType').value;
                    services.push(`Flowerbed Work - ${type}`);
                }
                if (document.getElementById('mowing').checked) {
                    const size = document.getElementById('lawnSize').value;
                    const freq = document.getElementById('mowingFrequency').value;
                    services.push(`Lawn Mowing - ${size} yard, ${freq}`);
                }
                if (document.getElementById('yardCleanup').checked) {
                    const scope = document.getElementById('cleanupScope').value;
                    services.push(`Yard Cleanup - ${scope}`);
                }
                if (document.getElementById('generalMaintenance').checked) {
                    const hours = document.getElementById('maintenanceHours').value;
                    services.push(`General Maintenance Services - ${hours} hours @ $30/hour`);
                }
                
                const isUrgent = document.getElementById('urgent').checked;
                const urgentText = isUrgent ? '\n\nüö® URGENT SERVICE REQUESTED (+25%)\nNext Day Service Required' : '';
                
                const description = [
                    document.getElementById('projectDescription').value || '',
                    '',
                    'Services Requested:',
                    ...services.map(s => `‚Ä¢ ${s}`),
                    urgentText,
                    '',
                    `Client Phone: ${document.getElementById('clientPhone').value || 'Not provided'}`,
                    `Service Address: ${document.getElementById('serviceAddress').value || 'Not provided'}`,
                    `Client Email: ${clientEmail}`
                ].filter(Boolean).join('\n');
                
                // Prepare data for Firebase
                const quoteData = {
                    task: projectName,
                    clientName: clientName,
                    phone: document.getElementById('clientPhone').value || '',
                    email: clientEmail,
                    address: document.getElementById('serviceAddress').value || '',
                    person: '',
                    status: 'Pending',
                    priority: isUrgent ? 'High' : 'Medium',
                    requestDate: new Date().toISOString().split('T')[0],
                    dueDate: '',
                    actualWorkHours: '0',
                    workHours: '0',
                    notes: description,
                    invoiceNumber: invoiceNumber,
                    totalPrice: document.getElementById('totalPrice').textContent.replace(/,/g, ''),
                    timeline: '',
                    source: 'RAPIDO Handyman Quote Form',
                    submittedAt: firebase.database.ServerValue.TIMESTAMP
                };
                
                // Submit to Firebase
                const requestRef = database.ref('requests').push();
                await requestRef.set(quoteData);
                
                // Save address to history for future autocomplete
                saveAddressToHistory(document.getElementById('serviceAddress').value);
                
                // Success
                successMsg.classList.add('show');
                submitBtn.innerHTML = '‚úì Submitted!';
                
                // Scroll to top
                window.scrollTo({ top: 0, behavior: 'smooth' });
                document.querySelector('.container').scrollIntoView({ behavior: 'smooth', block: 'start' });
                
                // Reset form after delay
                setTimeout(() => {
                    if (confirm('Submit another quote request?')) {
                        location.reload();
                    }
                }, 3000);
                
            } catch (error) {
                console.error('Submission error:', error);
                
                // Check if it's a Firebase permission error
                if (error.message.includes('PERMISSION_DENIED') || error.code === 'PERMISSION_DENIED') {
                    document.getElementById('errorText').innerHTML = `
                        <strong>‚ö†Ô∏è Database Permission Error</strong><br><br>
                        Your Firebase security rules are blocking submissions.<br><br>
                        <strong>To fix this:</strong><br>
                        1. Go to Firebase Console ‚Üí Realtime Database ‚Üí Rules<br>
                        2. Update rules to allow writes to "requests"<br>
                        3. Example rule: <code>{ "rules": { "requests": { ".write": true } } }</code><br><br>
                        <a href="https://console.firebase.google.com/project/${firebaseConfig.projectId}/database/${firebaseConfig.projectId}-default-rtdb/rules" target="_blank" style="color: #d97706; text-decoration: underline;">‚Üí Open Firebase Rules</a>
                    `;
                } else {
                    document.getElementById('errorText').textContent = `Error: ${error.message}`;
                }
                
                errorMsg.classList.add('show');
                submitBtn.disabled = false;
                submitBtn.innerHTML = 'Submit Request';
            }
        });
    </script>
</body>
</html>
